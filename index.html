<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BearAcc Pro - Final</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß∏</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, setDoc, getDocs, getDoc, where, writeBatch 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBXY_kuplXAslH11t4rLRVo0-kyqmt4m3E",
          authDomain: "lo-acc-fv.firebaseapp.com",
          projectId: "lo-acc-fv",
          storageBucket: "lo-acc-fv.firebasestorage.app",
          messagingSenderId: "757484054386",
          appId: "1:757484054386:web:a4d7825732c72183ec9feb",
          measurementId: "G-372P84L4GG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Expose to window
        window.db = db; window.auth = auth; window.collection = collection; window.doc = doc;
        window.addDoc = addDoc; window.updateDoc = updateDoc; window.deleteDoc = deleteDoc;
        window.onSnapshot = onSnapshot; window.query = query; window.getDocs = getDocs;
        window.where = where; window.writeBatch = writeBatch;

        signInAnonymously(auth).then(() => {
            console.log("Firebase Connected");
            window.isFirebaseReady = true;
            if(window.initApp) window.initApp();
        });
    </script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                extend: {
                    animation: { 'scale-in': 'scaleIn 0.3s ease-out forwards', 'fade-in': 'fadeIn 0.2s ease-out' },
                    keyframes: {
                        scaleIn: { 'from': { transform: 'scale(0.9)', opacity: '0' }, 'to': { transform: 'scale(1)', opacity: '1' } },
                        fadeIn: { 'from': { opacity: '0' }, 'to': { opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #020617; color: #f8fafc; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .filter-active { background-color: #334155; color: #fbbf24; border-color: #fbbf24; }
    </style>
</head>
<body class="min-h-screen pb-10">

    <div id="loading-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="bg-rose-600 p-8 rounded-2xl shadow-2xl flex flex-col items-center gap-4 animate-scale-in">
            <i class="ph ph-circle-notch animate-spin text-5xl"></i>
            <span class="font-bold text-lg">ƒêang t·∫£i d·ªØ li·ªáu Users...</span>
        </div>
    </div>

    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md p-8 rounded-3xl bg-slate-900 border border-slate-800 shadow-2xl animate-scale-in">
            <div class="flex flex-col items-center mb-8">
                <div class="bg-amber-500 p-4 rounded-full shadow-lg mb-4">
                    <i class="ph ph-bear text-white text-4xl"></i>
                </div>
                <h1 class="text-3xl font-black text-amber-500">BearAcc Pro</h1>
                <p class="text-slate-500 text-sm mt-1 flex items-center gap-2"><span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> Firebase Live Sync</p>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold uppercase text-slate-500 mb-1 ml-1">Username</label>
                    <input type="text" id="login-username" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl outline-none focus:border-amber-500 transition-all" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase text-slate-500 mb-1 ml-1">Password</label>
                    <input type="password" id="login-password" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl outline-none focus:border-amber-500 transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div id="login-error" class="hidden text-rose-500 text-xs font-bold text-center p-2 bg-rose-500/10 rounded-lg italic">
                    <i class="ph ph-warning-circle"></i> Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!
                </div>
                <button type="submit" class="w-full bg-amber-600 hover:bg-amber-500 text-white font-black py-4 rounded-xl shadow-lg shadow-amber-900/20 transition-all active:scale-95">ƒêƒÇNG NH·∫¨P</button>
            </form>
        </div>
    </div>

    <div id="app-screen" class="hidden">
        <header class="sticky top-0 z-40 bg-slate-950/80 backdrop-blur-md border-b border-slate-800 p-4">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="ph ph-bear-smile text-amber-500 text-3xl"></i>
                    <div>
                        <h2 class="font-black text-lg leading-none">BearAcc</h2>
                        <span id="display-user-role" class="text-[10px] font-bold uppercase text-slate-500">Role: Loading...</span>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button id="admin-user-btn" onclick="showUserManageModal()" class="hidden p-2.5 rounded-full bg-slate-800 text-purple-400 hover:bg-purple-900/30"><i class="ph ph-users-three text-xl"></i></button>
                    <button onclick="location.reload()" class="p-2.5 rounded-full bg-slate-800 text-rose-400 hover:bg-rose-900/30"><i class="ph ph-sign-out text-xl"></i></button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto p-4 md:p-6 space-y-6">
            <div id="stats-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                <div class="lg:col-span-4 space-y-6">
                    <div id="admin-tools" class="hidden space-y-6">
                        <div class="p-6 rounded-3xl bg-gradient-to-br from-indigo-900/40 to-slate-900 border border-indigo-500/30 shadow-xl">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2"><i class="ph ph-lightning text-amber-400"></i> B√°n Random</h3>
                            <div class="flex items-center gap-3 mb-4">
                                <button onclick="adjustSell(-1)" class="w-10 h-10 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center font-bold">-</button>
                                <input type="number" id="sell-qty" value="1" class="flex-1 bg-transparent text-center text-xl font-black outline-none" min="1">
                                <button onclick="adjustSell(1)" class="w-10 h-10 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center font-bold">+</button>
                            </div>
                            <button onclick="handleSellRandom()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-xl shadow-lg transition-all active:scale-95">B√ÅN NGAY</button>
                        </div>

                        <div class="p-6 rounded-3xl bg-slate-900 border border-slate-800 shadow-xl">
                            <h3 class="font-bold mb-4 flex items-center gap-2"><i class="ph ph-user-plus text-emerald-400"></i> Th√™m T√†i Kho·∫£n</h3>
                            <form onsubmit="handleAddAcc(event)" class="space-y-3">
                                <select id="acc-cat" class="w-full bg-slate-800 border border-slate-700 p-2 rounded-lg text-sm">
                                    <option value="Tp Tr·∫Øng">Tp Tr·∫Øng</option>
                                    <option value="Fv zin">Fv zin</option>
                                    <option value="Fcvn">Fcvn</option>
                                </select>
                                <input type="text" id="acc-user" placeholder="Email / Username" class="w-full bg-slate-800 border border-slate-700 p-2 rounded-lg text-sm outline-none focus:border-emerald-500" required>
                                <input type="text" id="acc-pass" placeholder="Password" class="w-full bg-slate-800 border border-slate-700 p-2 rounded-lg text-sm outline-none focus:border-emerald-500" required>
                                <input type="number" id="acc-price" placeholder="Gi√° (VNƒê)" class="w-full bg-slate-800 border border-slate-700 p-2 rounded-lg text-sm outline-none focus:border-emerald-500">
                                <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-500 py-3 rounded-xl font-bold mt-2">L∆ØU L·∫†I</button>
                            </form>
                        </div>
                    </div>

                    <div class="p-6 rounded-3xl bg-slate-900 border border-slate-800 shadow-xl">
                        <h3 class="font-bold mb-4 flex items-center gap-2"><i class="ph ph-magic-wand text-blue-400"></i> Hotmail Auto</h3>
                        <div class="p-4 bg-slate-950 rounded-xl mb-3 border border-dashed border-slate-700 font-mono text-xs space-y-2">
                            <div class="flex justify-between"><span class="text-slate-500">User:</span> <span id="gen-email" class="text-blue-400 cursor-pointer" onclick="copyText(this.innerText)">---</span></div>
                            <div class="flex justify-between"><span class="text-slate-500">Pass:</span> <span id="gen-pass" class="text-white cursor-pointer" onclick="copyText(this.innerText)">---</span></div>
                        </div>
                        <button onclick="genHotmail()" class="w-full bg-slate-800 hover:bg-slate-700 py-2 rounded-lg text-sm font-bold">RANDOM M·ªöI</button>
                    </div>
                </div>

                <div class="lg:col-span-8 flex flex-col h-[700px] bg-slate-900 border border-slate-800 rounded-3xl overflow-hidden shadow-2xl">
                    <div class="p-4 border-b border-slate-800 flex flex-wrap gap-2 items-center justify-between">
                        <h3 class="font-bold flex items-center gap-2">Kho Acc <span id="count-badge" class="px-2 py-0.5 bg-slate-800 rounded text-[10px]">0</span></h3>
                        <div class="flex gap-2">
                            <input type="text" id="search-input" oninput="doSearch(this.value)" placeholder="T√¨m..." class="bg-slate-800 border border-slate-700 px-3 py-1 rounded-lg text-xs outline-none focus:border-amber-500">
                            <select id="filter-cat" onchange="state.catFilter = this.value; renderList();" class="bg-slate-800 border border-slate-700 px-2 py-1 rounded-lg text-[10px] font-bold">
                                <option value="all">T·∫§T C·∫¢ LO·∫†I</option>
                                <option value="Tp Tr·∫Øng">TP TR·∫ÆNG</option>
                                <option value="Fv zin">FV ZIN</option>
                                <option value="Fcvn">FCVN</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex p-2 gap-1 bg-slate-950/50 overflow-x-auto scrollbar-hide">
                        <button onclick="setTab('all')" data-tab="all" class="tab-btn px-4 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all bg-slate-800 text-slate-500 filter-active">T·∫•t c·∫£</button>
                        <button onclick="setTab('pending')" data-tab="pending" class="tab-btn px-4 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all bg-slate-800 text-slate-500">Ch·ªù</button>
                        <button onclick="setTab('farming')" data-tab="farming" class="tab-btn px-4 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all bg-slate-800 text-slate-500">ƒêang c√†y</button>
                        <button onclick="setTab('completed')" data-tab="completed" class="tab-btn px-4 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all bg-slate-800 text-slate-500">Xong</button>
                        <button onclick="setTab('sold')" data-tab="sold" class="tab-btn px-4 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all bg-slate-800 text-slate-500">ƒê√£ b√°n</button>
                    </div>
                    <div id="acc-list" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="large-modal-overlay" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-md animate-fade-in">
        <div id="large-modal-content" class="w-full max-w-2xl bg-slate-900 border border-slate-700 rounded-3xl shadow-2xl overflow-hidden animate-scale-in"></div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] px-6 py-3 rounded-2xl shadow-2xl font-bold transition-all opacity-0 translate-y-5 pointer-events-none"></div>

    <script>
        let state = {
            currentUser: null, accounts: [], users: [], history: [],
            tab: 'all', catFilter: 'all', search: ''
        };

        const formatMoney = (v) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(v);

        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.className = `fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] px-6 py-3 rounded-2xl shadow-2xl font-bold transition-all ${type==='success'?'bg-emerald-600':'bg-rose-600'}`;
            t.style.opacity = '1'; t.style.transform = 'translate(-50%, 0)';
            setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translate(-50%, 20px)'; }, 2000);
        }

        function copyText(txt) {
            navigator.clipboard.writeText(txt);
            showToast("ƒê√£ copy!");
        }

        // --- AUTH & SYNC ---
        window.initApp = () => {
            document.getElementById('login-form').onsubmit = handleLogin;
            
            window.onSnapshot(window.collection(window.db, "accounts"), (snap) => {
                state.accounts = snap.docs.map(d => ({id: d.id, ...d.data()})).sort((a,b)=>b.createdAt - a.createdAt);
                renderStats(); renderList();
            });
            window.onSnapshot(window.collection(window.db, "users"), (snap) => {
                state.users = snap.docs.map(d => ({id: d.id, ...d.data()}));
            });
        };

        async function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('login-username').value.trim();
            const p = document.getElementById('login-password').value;
            const loading = document.getElementById('loading-modal');
            const error = document.getElementById('login-error');

            loading.classList.remove('hidden');
            error.classList.add('hidden');

            try {
                const q = window.query(window.collection(window.db, "users"), window.where("username", "==", u));
                const snap = await window.getDocs(q);
                
                let found = null;
                snap.forEach(d => { if(d.data().password === p) found = {id: d.id, ...d.data()}; });

                if(found) {
                    state.currentUser = found;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('app-screen').classList.remove('hidden');
                    document.getElementById('display-user-role').innerText = `Role: ${found.role.toUpperCase()}`;
                    if(found.role === 'admin') {
                        document.getElementById('admin-tools').classList.remove('hidden');
                        document.getElementById('admin-user-btn').classList.remove('hidden');
                    }
                } else {
                    error.classList.remove('hidden');
                }
            } catch(e) {
                console.error(e);
                showToast("L·ªói k·∫øt n·ªëi Firebase!", "error");
            } finally {
                loading.classList.add('hidden'); // CH·ªêT: ƒê√≥ng modal ƒë·ªè t·∫°i ƒë√¢y
            }
        }

        // --- DASHBOARD LOGIC ---
        function renderStats() {
            const grid = document.getElementById('stats-grid');
            const metrics = [
                { lab: 'T·∫•t c·∫£', val: state.accounts.length, color: 'slate' },
                { lab: 'Ch·ªù', val: state.accounts.filter(a=>a.status==='pending').length, color: 'amber' },
                { lab: 'ƒêang c√†y', val: state.accounts.filter(a=>a.status==='farming').length, color: 'blue' },
                { lab: 'Xong', val: state.accounts.filter(a=>a.status==='completed').length, color: 'emerald' },
                { lab: 'Doanh thu', val: formatMoney(state.accounts.filter(a=>a.status==='sold').reduce((s,a)=>s+(a.price||0), 0)), color: 'rose', full: true }
            ];
            grid.innerHTML = metrics.map(m => `
                <div class="bg-slate-900 border border-slate-800 p-4 rounded-2xl ${m.full?'col-span-2 md:col-span-1':''}">
                    <div class="text-[10px] font-bold uppercase text-slate-500 mb-1">${m.lab}</div>
                    <div class="text-xl font-black text-${m.color}-500">${m.val}</div>
                </div>
            `).join('');
        }

        function renderList() {
            const container = document.getElementById('acc-list');
            const filtered = state.accounts.filter(a => {
                const matchTab = state.tab === 'all' || a.status === state.tab;
                const matchCat = state.catFilter === 'all' || a.category === state.catFilter;
                const matchSearch = a.username.toLowerCase().includes(state.search.toLowerCase());
                return matchTab && matchCat && matchSearch;
            });

            document.getElementById('count-badge').innerText = filtered.length;
            container.innerHTML = filtered.map(a => `
                <div class="bg-slate-950/50 border border-slate-800 p-4 rounded-2xl flex flex-col gap-3 group">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-[9px] font-black uppercase px-2 py-0.5 rounded bg-slate-800 text-slate-400">${a.category}</span>
                            <div class="mt-1 font-mono font-bold text-amber-500 cursor-pointer hover:underline" onclick="copyText('${a.username}')">${a.username}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-black text-emerald-500">${formatMoney(a.price||0)}</div>
                            <div class="text-[10px] text-slate-600 font-bold uppercase">T·∫°o: ${new Date(a.createdAt).toLocaleDateString()}</div>
                        </div>
                    </div>
                    ${state.currentUser.role === 'admin' ? `
                    <div class="flex items-center gap-2 pt-2 border-t border-slate-800/50">
                        <select onchange="updateAccStatus('${a.id}', this.value)" class="bg-slate-800 text-[10px] font-bold p-1 rounded-lg outline-none">
                            <option value="pending" ${a.status==='pending'?'selected':''}>‚è≥ CH·ªú</option>
                            <option value="farming" ${a.status==='farming'?'selected':''}>‚öîÔ∏è C√ÄY</option>
                            <option value="completed" ${a.status==='completed'?'selected':''}>‚úÖ XONG</option>
                            <option value="sold" ${a.status==='sold'?'selected':''}>üí∞ B√ÅN</option>
                        </select>
                        <div class="flex-1"></div>
                        <button onclick="delAcc('${a.id}')" class="text-rose-500 hover:bg-rose-500/10 p-1.5 rounded-lg opacity-0 group-hover:opacity-100"><i class="ph ph-trash"></i></button>
                    </div>` : ''}
                </div>
            `).join('');
        }

        // --- BUSINESS ACTIONS ---
        window.handleAddAcc = async (e) => {
            e.preventDefault();
            const data = {
                category: document.getElementById('acc-cat').value,
                username: document.getElementById('acc-user').value.trim(),
                password: document.getElementById('acc-pass').value.trim(),
                price: parseInt(document.getElementById('acc-price').value) || 0,
                status: 'pending', createdAt: Date.now()
            };
            await window.addDoc(window.collection(window.db, "accounts"), data);
            showToast("ƒê√£ th√™m!"); e.target.reset();
        };

        window.updateAccStatus = async (id, s) => {
            await window.updateDoc(window.doc(window.db, "accounts", id), { status: s });
            showToast("ƒê√£ c·∫≠p nh·∫≠t!");
        };

        window.delAcc = async (id) => {
            if(confirm("X√≥a t√†i kho·∫£n n√†y?")) {
                await window.deleteDoc(window.doc(window.db, "accounts", id));
                showToast("ƒê√£ x√≥a!");
            }
        };

        window.adjustSell = (v) => {
            let el = document.getElementById('sell-qty');
            el.value = Math.max(1, parseInt(el.value) + v);
        };

        window.handleSellRandom = async () => {
            const qty = parseInt(document.getElementById('sell-qty').value);
            const ready = state.accounts.filter(a => a.status === 'completed');
            if(ready.length < qty) return showToast(`Kh√¥ng ƒë·ªß acc (C√≤n ${ready.length})`, "error");

            if(confirm(`B√°n ${qty} acc ng·∫´u nhi√™n?`)) {
                const batch = window.writeBatch(window.db);
                ready.slice(0, qty).forEach(a => {
                    batch.update(window.doc(window.db, "accounts", a.id), { status: 'sold' });
                });
                await batch.commit();
                showToast(`ƒê√£ b√°n ${qty} t√†i kho·∫£n!`);
            }
        };

        window.setTab = (t) => {
            state.tab = t;
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.toggle('filter-active', b.dataset.tab === t);
            });
            renderList();
        };

        window.doSearch = (v) => { state.search = v; renderList(); };

        window.genHotmail = () => {
            const u = Math.random().toString(36).slice(2, 10) + "@hotmail.com";
            const p = Math.random().toString(36).slice(2, 10).toUpperCase() + "!";
            document.getElementById('gen-email').innerText = u;
            document.getElementById('gen-pass').innerText = p;
        };

        // --- USER MANAGEMENT ---
        window.showUserManageModal = () => {
            const overlay = document.getElementById('large-modal-overlay');
            const content = document.getElementById('large-modal-content');
            overlay.classList.remove('hidden');
            content.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-black flex items-center gap-2"><i class="ph ph-users text-purple-500"></i> Qu·∫£n l√Ω Users</h2>
                        <button onclick="document.getElementById('large-modal-overlay').classList.add('hidden')" class="text-slate-500 hover:text-white"><i class="ph ph-x text-2xl"></i></button>
                    </div>
                    <form onsubmit="createUser(event)" class="grid grid-cols-1 md:grid-cols-4 gap-2 mb-6 p-4 bg-slate-800 rounded-2xl">
                        <input type="text" id="n-user" placeholder="User" class="bg-slate-900 p-2 rounded-lg text-xs outline-none focus:border-purple-500 border border-slate-700" required>
                        <input type="text" id="n-pass" placeholder="Pass" class="bg-slate-900 p-2 rounded-lg text-xs outline-none focus:border-purple-500 border border-slate-700" required>
                        <select id="n-role" class="bg-slate-900 p-2 rounded-lg text-xs border border-slate-700">
                            <option value="viewer">Viewer</option>
                            <option value="admin">Admin</option>
                        </select>
                        <button class="bg-purple-600 font-bold text-xs rounded-lg py-2">Th√™m</button>
                    </form>
                    <div class="space-y-2 max-h-[300px] overflow-y-auto pr-2">
                        ${state.users.map(u => `
                            <div class="flex justify-between items-center p-3 bg-slate-950/50 border border-slate-800 rounded-xl">
                                <div><span class="font-bold">${u.username}</span> <span class="text-[10px] px-1 bg-indigo-900 text-indigo-300 rounded">${u.role}</span></div>
                                <button onclick="delUser('${u.id}', '${u.username}')" class="text-rose-500 hover:bg-rose-500/10 p-1.5 rounded-lg"><i class="ph ph-trash"></i></button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        window.createUser = async (e) => {
            e.preventDefault();
            await window.addDoc(window.collection(window.db, "users"), {
                username: document.getElementById('n-user').value.trim(),
                password: document.getElementById('n-pass').value.trim(),
                role: document.getElementById('n-role').value
            });
            showToast("ƒê√£ t·∫°o user!"); showUserManageModal();
        };

        window.delUser = async (id, name) => {
            if(name === state.currentUser.username) return showToast("Kh√¥ng th·ªÉ t·ª± x√≥a m√¨nh!", "error");
            if(confirm(`X√≥a user ${name}?`)) {
                await window.deleteDoc(window.doc(window.db, "users", id));
                showUserManageModal();
            }
        };

    </script>
</body>
</html>
